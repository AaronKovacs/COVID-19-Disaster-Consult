{% extends "base-pages/base-site-specific.html" %}
{% from "components/issues.html" import display_issue_content %}


{% block main_content %}
<div class="fab" style="bottom: 30px; right: 50%;">
  <a class="btn-floating btn-sm btn-primary noprint" href="javascript:printIssue('#issueContentDiv');">
    <i class="fas fa-print noprint"></i>
  </a>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-12 {% if useful_links %}col-lg-8{% endif %}">
      <div id="issueContentDiv"
        class="row {% if request.path == url_for('Pages_home', site='covid-19') %}mt-0{%else%}mt-2{%endif%}">
        <div class="text-center w-100">
          {% if request.path == url_for('Pages_home', site='covid-19') %}
          <h2 class="mb-0">
            GW COVID-19 Intelligence Report
            {% if current_user.is_authenticated and current_user.privilege > 300 %}
            <small class="text-muted">
              <a class="" target="_blank" data-toggle="tooltip" data-placement="right" title="Edit Issue | Admin"
                href="{{ url_for('Issues_view', id=issue.id, site=site) }}">
                <i class="fas fa-pencil-alt ml-2"></i>
              </a>
            </small>
            {% endif %}
          </h2>
          <h5 class="h5-responsive text-muted mb-0">
            Obtained from
            <a id="himmelPopOver-unused" href="https://guides.himmelfarb.gwu.edu/SituationReport" target="_blank">GW
              Himmelfarb
              Library</a>
            | Report generated on {{issue.subtitle}}
          </h5>
          <h6 class="h6-responsive text-muted">Created by GW School of Medicine and Health Sciences, Himmelfarb Health
            Sciences Library and the GW Covid-19 Incident Management Intelligence Unit</h6>
            {% else %}
            <h2 class="mb-0">
              Background Information
              {% if current_user.is_authenticated and current_user.privilege > 300 %}
              <small class="text-muted">
                <a class="" target="_blank" data-toggle="tooltip" data-placement="right" title="Edit Issue | Admin"
                  href="{{ url_for('Issues_view', id=issue.id, site=site) }}">
                  <i class="fas fa-pencil-alt ml-2"></i>
                </a>
              </small>
              {% endif %}
            </h2>
            {% endif %}
        </div>
        <div class="blueLine" style="margin-bottom: 1em;"></div>
        <div class="container-fluid">
          {% if issue_id %}
          {{ display_issue_content(issue_content) }}
          {% else %}
          <div class="row w-100 justify-content-center">
            <div class="alert alert-warning" role="alert">
              <h4 class="alert-heading text-center">Under Construction</h4>
              <p>We are working hard to bring you relevant background information on this disaster.</p>
              <p class="mb-0">In the meantime, please use the Table of Contents to navigate to the category you would
                like</p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    {% if useful_links %}
    <div class="col-12 col-lg-4 pl-lg-4 pr-0">
      <div class="sticky-top" style="top: 90px; z-index: 2;">
        <div class="useful-links-box scrollbar-custom">
          <div class="sticky-top box-title">
            <h4>
              Useful Links
              {% if current_user.is_authenticated and current_user.privilege > 300 %}
              <small class="text-muted">
                <a class="" target="_blank" data-toggle="tooltip" data-placement="right" title="Edit Links | Admin"
                  href="{{ url_for('URLs_list_urls', site=site) }}">
                  <i class="fas fa-pencil-alt ml-2"></i>
                </a>
              </small>
              {% endif %}
            </h4>
            <div class="blueLine"></div>
          </div>
          {% for key, value in useful_links.items() %}
          <h5 class="mb-0">{{key}}</h5>
          <ul class="list-unstyled ml-4 mb-1">
            {% for link_item in value %}
            <li class=""><a href="{{link_item.url}}" target="_blank">{{link_item.title}}</a></li>
            {% endfor %}
          </ul>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</div>


<div id="popover_content_wrapper" style="display: none">
  <h6 class="h6-responsive">Created by GW School of Medicine and Health Sciences, Himmelfarb Health Sciences Library and
    the GW Covid-19 Incident
    Management Intelligence Unit</h6>
</div>
{% endblock %}


{% block scripts_content %}
<script>
  $(function () {
    $('#himmelPopOver').popover({
      container: 'body',
      html: true,
      trigger: 'hover focus',
      placement: 'bottom',
      title: "GW COVID-19 Intelligence Report",
      content: function () { return $('#popover_content_wrapper').html(); }
    });
  })

  function printIssue(el) {
    var dateStr = getDateTimeString();

    var htmlHeading = `<div class="container mt-4">
                          <div class="row justify-content-center">
                            <div class="col-12 text-center ">
                              <img src="../../static/images/logoWide.png" class="img-fluid" alt="Logo" style="max-width: 150px;">
                            </div>
                            <div class="col-12 text-center ">
                              <h1 class="h1-responsive mb-0">Disaster Consult</h1>
                            </div>
                            <div class="col-12 text-center ">
                              <small class="text-muted">Content Retrieved On ${dateStr} </small>
                            </div>
                            <div class="col-12 text-center ">
                              <hr>
                            </div>
                          </div>
                        </div>`;
    var htmlFooter = `<div class="container mt-2">
                        <div class="row justify-content-center">
                          <div class="col-12 text-center ">
                            <hr>
                          </div>
                          <div class="col-12 text-center ">
                            <h1 class="h1-responsive mb-1">DisasterConsult.org</h1>
                          </div>
                          <div class="col-12 text-center ">
                              <small class="text-muted">{{copyright_text()}}</small>
                            </div>
                        </div>
                      </div>`;

    $(el).printThis({
      pageTitle: 'Disaster Consult | {{site}}',
      header: htmlHeading,
      footer: htmlFooter
    });
  }
</script>
{% endblock %}